---
layout: post
title: 'Learning to Love the ADR - Part 4: Incident Packaging Service'
date: '2013-02-02T12:00:00.000-06:00'
author: Don Seiler
tags:
- 11g
- dba
- ADR
- oracle
- diagnostics
modified_time: '2013-02-05T08:41:11.980-06:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-3371802102691123141
blogger_orig_url: http://www.seiler.us/2013/02/learning-to-love-adr-part-4-incident.html
---

<i style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; font-size: 13px; line-height: 18px;">This post is the fourth (and final) in a short series about Oracle 11g ADR. These posts are based on the presentations I gave at the NoCOUG Summer Conference in August 2011 and at the RMOUG Training Days in February 2012.</i><br /><i style="background-color: white; color: #666666; font-family: 'Trebuchet MS', Trebuchet, Verdana, sans-serif; font-size: 13px; line-height: 18px;"><br /></i><br /><h3><span style="color: #666666;"><span style="line-height: 18px;">IPS</span></span></h3><br /><span style="color: #666666;"><span style="line-height: 18px;">Any DBA that has had to file a support request with Oracle Support will be violently nodding their head in agreement when I ask if they've ever had Oracle Support ask for log file after trace file after log file after trace file. It's hard to not be cynical, especially when they sometimes request a file that was already provided! In 11g, Oracle has made some of that work easier by providing the Incident Packaging Service, or IPS, with the ADR. IPS lets you quickly and easily gather up diagnostic files related to a given incident, problem, or timeframe. You can also create empty packages and add whatever files you see fit.</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">It all starts with the IPS CREATE PACKAGE command. This creates a logical package (no package files are created at this point) in the ADR. Various options include:</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><br /><ul><li><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips create package incident &lt;incident_id&gt;;</span></span></li><li><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips create package problem &lt;problem_id&gt;;</span></span></li><li><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips create package problemkey "problem_key_string";</span></span></li><li><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips create package seconds &lt;seconds_before_now&gt;;</span></span></li><li><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips create package time 'start_timestamp' to 'end_timestamp';</span></span></li><li><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips create package;</span></span></li></ul><div><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">It is definitely worth your while to review the output of <span style="font-family: Courier New, Courier, monospace;">help ips create package</span> to get details on these, as I won't be touching most of them any further. The last command listed creates an empty package, after which you can use the&nbsp;<span style="font-family: Courier New, Courier, monospace;">ips add incident</span> or <span style="font-family: Courier New, Courier, monospace;">ips add file</span> commands to add data to the package before generating it.</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"></span></span><br /><a name='more'></a><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">When you are ready to generate the package file to send to Oracle Support, run the IPS GENERATE PACKAGE command, e.g.</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace; line-height: 18px;">adrci&gt; ips generate package 3 in /home/dts/files/;</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">This will create a zip file in the specified directory. The package number is given to you when you first create the package, as our later example will demonstrate.</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">Focusing on the first example, when you run "show incident" in adrci, it will provide you with the list of incidents and their incident numbers. If you feel the need to create an SR with Oracle Support for this incident, you can use that command to create a package based on that incident number, and then generate the package file for that package. However you can do both in one step using IPS PACK INCIDENT:</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips pack incident &lt;incident_id&gt; in &lt;path&gt;;</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">For eaxmple:</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666; font-family: Courier New, Courier, monospace;"><span style="line-height: 18px;">adrci&gt; ips pack incident 13579 in /home/dts/files/;</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">This command creates a package and generates the zip file in one step.</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><br /><h3><span style="color: #666666;"><span style="line-height: 18px;">Example Time!</span></span></h3><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"><span style="line-height: 18px;">Now that I've bored you with the details, lets go through an example incident that you can reproduce in your sandboxes at home, as I'm doing now as I write this.</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><br /><h4><span style="color: #666666;"><span style="line-height: 18px;">Step 1: Cause an Incident!</span></span></h4><div><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span></div><span style="color: #666666;"><span style="line-height: 18px;">Rather than really cause some harm to my sandbox, let's just set things up so something that normally wouldn't create an incident does so this once:</span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><br /></span></span><span style="color: #666666;"></span><br /><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter session set events '942 incident(table_missing)';</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">Session altered.</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; drop table doesnotexist;</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">drop table doesnotexist</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">ERROR at line 1:</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">ORA-00942: table or view does not exist</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter session set events '942 trace name context off';</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">Session altered.</span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><br /></span></div><div style="line-height: 18px;"><span style="color: #666666;">Viewing the trace (human-readable text) alert log:</span></div><div style="line-height: 18px;"><span style="color: #666666;"><br /></span></div><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Wed Jan 30 13:56:20 2013</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Errors in file /home/oracle/app/oracle/diag/rdbms/orcl/orcl/trace/orcl_ora_25751.trc &nbsp;(incident=10993):</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">ORA-00700: soft internal error, arguments: [EVENT_CREATED_INCIDENT], [942], [TABLE_MISSING], [], [], [], [], [], [], [], [], []</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">ORA-00942: table or view does not exist</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Incident details in: /home/oracle/app/oracle/diag/rdbms/orcl/orcl/incident/incdir_10993/orcl_ora_25751_i10993.trc</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Wed Jan 30 13:56:25 2013</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Dumping diagnostic data in directory=[cdmp_20130130135624], requested by (instance=1, osid=25751), summary=[incident=10993].</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Wed Jan 30 13:56:25 2013</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Sweep [inc][10993]: completed</span></span></span><br /><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Sweep [inc2][10993]: completed</span></span></span><br /><div style="line-height: 18px;"><span style="color: #666666;"><br /></span></div><h4><span style="color: #666666;">Step 2: Use ADRCI to view the incident</span></h4><div><span style="color: #666666;"><br /></span></div><div style="line-height: 18px;"><span style="color: #666666;">So our weary DBA is awaked by a page from the monitoring system and can now quickly see what the problem was without having to track down alert log locations and such.</span></div><div style="line-height: 18px;"><span style="color: #666666;"><br /></span></div><div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost ~]$ adrci</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">ADRCI: Release 11.2.0.2.0 - Production on Wed Jan 30 13:58:29 2013</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">Copyright (c) 1982, 2009, Oracle and/or its affiliates. &nbsp;All rights reserved.</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">ADR base = "/home/oracle/app/oracle"</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; show homes</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">ADR Homes:</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">diag/rdbms/orcl/orcl</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">diag/tnslsnr/localhost/listener</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; set home diag/rdbms/orcl/orcl</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; show incident</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">ADR Home = /home/oracle/app/oracle/diag/rdbms/orcl/orcl:</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">*************************************************************************</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">INCIDENT_ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PROBLEM_KEY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CREATE_TIME</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">-------------------- ----------------------------------------------------------- ----------------------------------------</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">10993 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ORA 700 [EVENT_CREATED_INCIDENT] [942] [TABLE_MISSING] &nbsp; &nbsp; &nbsp;2013-01-30 13:56:20.294000 -06:00</span></span></span></div><div><span style="color: #666666;"><span style="line-height: 18px;"><span style="font-family: Courier New, Courier, monospace;">1 rows fetched</span></span></span></div><div style="line-height: 18px;"><span style="color: #666666;"><br /></span></div></div><div style="line-height: 18px;"><span style="color: #666666;">Here we see the INCIDENT_ID is 10993, which we'll need to reference later. Now let's assume it's something more sinister and we feel the need to file an SR with Oracle Support and want to upload some files.</span></div><div style="line-height: 18px;"><span style="color: #666666;"><br /></span></div><h4><span style="color: #666666;">Step 3: Create a Package!</span></h4><div><div><span style="color: #666666;"><br /></span></div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; ips create package incident 10993;</span></span></div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">Created package 1 based on incident id 10993, correlation level typical</span></span></div></div><div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; ips generate package 1 in /home/oracle;</span></span></div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">Generated package 1 in file /home/oracle/ORA700EVE_20130130140011_COM_1.zip, mode complete</span></span></div></div><div><span style="color: #666666;"><br /></span></div><div><span style="color: #666666;">... or ...</span></div><div><span style="color: #666666;"><br /></span></div><div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; ips pack incident 10993;</span></span></div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">Generated package 2 in file /home/oracle/ORA700EVE_20130130140052_COM_1.zip, mode complete</span></span></div></div><div><span style="color: #666666;"><br /></span></div><div><span style="color: #666666;">Both methods achieve the same result, with the exception of the resulting package file name, which as you can see is based on YYYYMMDDHH24MMSS date format. You can see that a new package is generated (1 vs 2). The zip file that is created is a standard zip file, you can use unzip -l &lt;file_name&gt; to look at the contents if you wish. You'll see a number of .dmp files, along with the XML and trace alert log files and other trace files that Oracle has deemed relevant to its needs. Alternatively, you can use IPS to query this information as well:</span></div><div><span style="color: #666666;"><br /></span></div><div><span style="color: #666666;"><span style="font-family: Courier New, Courier, monospace;">adrci&gt; ips show files package &lt;package_number&gt;;</span></span></div><div><span style="color: #666666;"><br /></span></div><div><span style="color: #666666;">This will give you a nicely formatted listing of each file in the package, with some metadata for each file.&nbsp;</span><span style="color: #666666;">All that's left now is to upload the package zip file to your SR and hope that Oracle Support can see what they need to see!</span></div><br />Well, that's it folks. Hopefully you found this somewhat informative and it leads you to do a little more digging into ADRCI on your own. At the very least you can now get rid of those ugly alert log text scraping scripts!</div>