---
layout: post
title: Oracle Restart Underscore Warning!
date: '2013-10-10T13:15:00.000-05:00'
author: Don Seiler
tags:
- 11g
- oracle restart
- 11gR2
- oracle
- srvctl
modified_time: '2014-09-15T14:16:04.234-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-3494354389690266811
blogger_orig_url: http://www.seiler.us/2013/10/oracle-restart-underscore-warning.html
---

Bobby Curtis just posted a great post about <a class="vt-p" href="http://dbasolved.com/2013/10/10/add-database-to-oracle-restart/" target="_blank">adding a database to Oracle Restart</a>, aka srvctl. The post is a must-read, but I do have one thing to add. In Bobby's example, he leaves out the instance_name clause (noted by the -i parameter). This won't cause a problem for him because his database's db_unique_name has no underscores and matches his ORACLE_SID (which can't contain underscores anyway).<br /><br />In my environment, however, nearly every database has a db_unique_name value that contains an underscore, which we use to denote the datacenter location. For example, in our dataguard configuration for "prod", prod_ny would be in New York where as prod_sf would be in San Francisco. The fact that it is part of a dataguard configuration is irrelevant, we have this configuration with standalone databases (e.g. staging1_ny) as well just to be consistent. In the first example, both databases have a db_name and ORACLE_SID of "prod", and the second example would have an ORACLE_SID of staging1.<br /><br /><a name='more'></a><br /><br />However when you add this to Oracle Restart by the typical default syntax, you'll run into a problem. When the instance_name is not specified, srvctl will use the db_unique_name but strip out any underscore characters. This results in an instance_name value of "staging1ny" in the following example, when we were running under just "staging1" previously:<br /><br /><div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;">$ srvctl add database -d staging1_ny \</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;">&gt; -o /oracle/app/product/11.2 \</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;">&gt; -p /mnt/staging1/pfile/spfilestaging1.ora \</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;">&gt; -r PHYSICAL_STANDBY -s open -t immediate</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;"><br />$ srvctl config database -d&nbsp;staging1_ny<br />Database unique name:&nbsp;staging1_ny<br />Database name:<br />Oracle home: /oracle/app/product/11.2<br />Oracle user: oracle<br />Spfile: /mnt/staging1/pfile/spfilestaging1.ora<br />Domain:<br />Start options: open<br />Stop options: immediate<br />Database role:&nbsp;PHYSICAL_STANDBY<br />Management policy: AUTOMATIC<br /><b><span style="color: red;">Database instance:&nbsp;staging1ny</span></b><br />Disk Groups:<br />Services:</span></div></div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><br /></div>Now the problem with this is that when you next use srvctl to start the instance, it will run under a different ORACLE_SID than you had used before, and the location of the ADR files (most notably the alert log) will change.<br /><br />The solution is simply to either use -i to specify the instance_name when adding the database, or use the "srvctl modify database" command to specify it afterward, like this:<br /><br /><span style="font-family: Courier New, Courier, monospace;">$ srvctl modify database -d staging1_ny -i staging1</span><br /><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;"><br />$ srvctl config database -d&nbsp;staging1_ny<br />Database unique name:&nbsp;staging1_ny<br />Database name:<br />Oracle home: /oracle/app/product/11.2<br />Oracle user: oracle<br />Spfile: /mnt/staging1/pfile/spfilestaging1.ora<br />Domain:<br />Start options: open<br />Stop options: immediate<br />Database role:&nbsp;PHYSICAL_STANDBY<br />Management policy: AUTOMATIC<br /><b>Database instance:&nbsp;staging1</b><br />Disk Groups:<br />Services:</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><span style="font-family: inherit;">Some might say this is a corner case but in my shop with many production, dev, and staging databases with many physical and snapshot standbys, it's an everyday part of my life and something that surprised me when I first started trying to herd new databases under Oracle Restart.</span>