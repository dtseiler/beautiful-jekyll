---
layout: post
title: 'Learning to Love the ADR - Part 1: Location, Location, Location!'
date: '2012-10-26T15:07:00.001-05:00'
author: Don Seiler
tags:
- 11g
- dba
- ADR
- oracle
- diagnostics
modified_time: '2012-10-27T01:17:20.085-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-3671807443227556628
blogger_orig_url: http://www.seiler.us/2012/10/learning-to-love-adr-part-1-location.html
---

<i>This post is the first in a short series about Oracle 11g ADR. These posts are based on the presentations I gave at the NoCOUG Summer Conference in August 2011 and at the RMOUG Training Days in February 2012.</i><br /><br />The Automatic Diagnostic Repository, or "ADR", is a location on disk where an Oracle instance keeps many files of diagnostic data that tools like Enterprise Manager or ADR Command Interpreter (adrci) use for gathering and presenting information to the user. When we refer to diagnostic files, we are talking about:<br /><ul><li>Alert logs (RDBMS instance, ASM instance, Listener)</li><li>Trace files (e.g. 10046 or 10053 as well as system-generated)</li><li>Core dumps</li></ul><div>Now in prior versions of Oracle, you would expect to find these files under $ORACLE_BASE/admin/$ORACLE_SID in bdump, cdump or udump, by default. You could always specify different locations with the %_DUMP_DEST initialization parameters, of course. The log files would grow ad infinitum if not properly rotated, compressed, archived and/or truncated, possibly causing some headaches with disk space management.<br /><br />As of Oracle 11g, however, much (but not all) of this is managed by the instance now. As an added bonus, Oracle moved the locations of these files, as I'm sure many of you with alert log monitoring software have found out by now.&nbsp;The thing that catches most DBAs off-guard when upgrading to 11g is the change in location for these files, especially the alert log.<br /><br /><a name='more'></a><br /><br />Well, Oracle Corporation has seen fit to unify all these various alert, trace and dump files under the ADR location, which is specified in the DIAGNOSTIC_DEST initialization parameter. This one parameter replaces all of the %_DUMP_DEST parameters, and defaults to the value of the $ORACLE_BASE environment variable <i>at the time of instance startup</i>. If the $ORACLE_BASE environment variable is unset, then DIAGNOSTIC_DEST defaults to $ORACLE_HOME/log.</div><div><br /><h3>Beware the ORACLE_BASE</h3></div><div>Note that I emphasized "at the time of instance startup" earlier. This is important because you may come across servers where the ORACLE_BASE variable might not be defined when the instance is first started. In this case the ADR will be under $ORACLE_HOME/log. Then a DBA consultant might come along and standardize the login profile with an ORACLE_BASE setting, and upon next startup the DIAGNOSTIC_DEST will move. This can make things confusing for DBAs trying to find older diagnostic files in the new ADR location if they don't know (and rarely expect) this kind of situation. Yet it is one that I have personally witnessed and was one of the initial motivations for me to put this presentation together and learn more about the ADR for my own benefit.</div><div><br /></div><div>Let's demonstrate this quickly. I have my working 11.2.0.1 sandbox on Oracle Linux. I set the full slate of environment vars via oraenv:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost ~]$ . oraenv</span></div><div><span style="font-family: Courier New, Courier, monospace;">ORACLE_SID = [oracle] ? ora11201</span></div><div><span style="font-family: Courier New, Courier, monospace;">The Oracle base for ORACLE_HOME=/oracle/app/oracle/product/11.2.0/dbhome_1 is /oracle/app/oracle</span></div></div><div><br /></div><div>Then I launch sqlplus and start the instance, then check the diagnostic_dest parameter value:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter diagnost</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">diagnostic_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;/oracle/app/oracle</span></div></div><div><br /></div><div>That is as expected. I can verify that my ADR files exist under there</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost ~]$ ls /oracle/app/oracle/diag/rdbms/ora11201/ora11201/</span></div><div><span style="font-family: Courier New, Courier, monospace;">alert &nbsp;cdump &nbsp;hm &nbsp;incident &nbsp;incpkg &nbsp;ir &nbsp;lck &nbsp;metadata &nbsp;stage &nbsp;sweep &nbsp;trace</span></div></div><div><br /></div><div>Now, shutdown the database and create a pfile from the spfile (if you use an spfile). Then be sure rename the spfile so it isn't used during startup. Next we unset the necessary initialization parameters and environment variable.</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ echo $ORACLE_BASE</span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/oracle</span></div></div><div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ unset ORACLE_BASE</span></div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ echo $ORACLE_BASE</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ vi initora11201.ora&nbsp;</span></div></div><div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ grep "#" initora11201.ora&nbsp;</span></div><div><span style="font-family: Courier New, Courier, monospace;">#ora11201.__oracle_base='/oracle/app/oracle'#ORACLE_BASE set from environment</span></div><div><span style="font-family: Courier New, Courier, monospace;">#*.diagnostic_dest='/oracle/app/oracle'</span></div></div><div><br /></div><div>Note I also had to comment out the __oracle_base instance parameter value in the pfile. At this point our instance will have no knowledge or ties to the old ORACLE_BASE. Now, log back into sqlplus and startup (or even just startup nomount) and check again:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter diagnostic_dest</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">diagnostic_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;/oracle/app/oracle/product/11.</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.0/dbhome_1/log</span></div></div><div><br /></div><div>You can see we're now using the value of $ORACLE_HOME/log. Look under that directory and you'll indeed find the full set of ADR files you would expect:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ ls /oracle/app/oracle/product/11.2.0/dbhome_1/log/diag/rdbms/ora11201/ora11201/</span></div><div><span style="font-family: Courier New, Courier, monospace;">alert &nbsp;cdump &nbsp;hm &nbsp;incident &nbsp;incpkg &nbsp;ir &nbsp;lck &nbsp;metadata &nbsp;stage &nbsp;sweep &nbsp;trace</span></div></div><div><br /></div><div>The only problem is that it doesn't have any of the history contained in the files in the old ADR.</div><div><br /></div><div>The bottom line? Be careful and make sure your $ORACLE_BASE is properly set and I strongly advise you to <b>explicitly set your diagnostic_dest</b> initialization parameter so it doesn't rely on environment variables.</div><div><br /><h3>V$DIAG_INFO</h3></div><div>Other than checking the diagnostic_dest value, you can also query the view V$DIAG_INFO to see where everything is going:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; select name, value from v$diag_info;</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">--------------------- ---------------------------------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">Diag Enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TRUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">ADR Base &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/oracle/app/oracle</span></div><div><span style="font-family: Courier New, Courier, monospace;">ADR Home &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/ora11201/ora11201</span></div><div><span style="font-family: Courier New, Courier, monospace;">Diag Trace &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/ora11201/ora11201/trace</span></div><div><span style="font-family: Courier New, Courier, monospace;">Diag Alert &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/ora11201/ora11201/alert</span></div><div><span style="font-family: Courier New, Courier, monospace;">Diag Incident &nbsp; &nbsp; &nbsp; &nbsp; /oracle/app/oracle/diag/rdbms/ora11201/ora11201/incident</span></div><div><span style="font-family: Courier New, Courier, monospace;">Diag Cdump &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/ora11201/ora11201/cdump</span></div><div><span style="font-family: Courier New, Courier, monospace;">Health Monitor &nbsp; &nbsp; &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/ora11201/ora11201/hm</span></div><div><span style="font-family: Courier New, Courier, monospace;">Default Trace File &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/ora11201/ora11201/trace/</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace;">ora1</span><span style="font-family: 'Courier New', Courier, monospace;">1201_ora_16064.trc</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">--------------------- ---------------------------------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">Active Problem Count &nbsp;0</span></div><div><span style="font-family: Courier New, Courier, monospace;">Active Incident Count 0</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">11 rows selected.</span></div></div><div><br /><h3>Deprecated Variables</h3></div><div>Now the old %_DUMP_DEST initialization parameters are deprecated and will default to values based on the DIAGNOSTIC_DEST value. But, while I'm here, let's test another question that's rattled around my brain: What happens if we set both DIAGNOSTIC_DEST and BACKGROUND_DUMP_DEST to different paths?</div><div><br /></div><div>To test, I quickly made a bdump directory in my user home and set the old background_dump_dest value in the pfile:</div><br /><div><span style="font-family: Courier New, Courier, monospace;">[oracle@localhost dbs]$ grep background_dump_dest initora11201.ora&nbsp;</span></div><div><span style="font-family: Courier New, Courier, monospace;">*.background_dump_dest='/home/oracle/test_bdump';</span></div><div><br /></div><div>I'll note that I've also uncommented the diagnosted_dest value from before. Now, we startup and we immediately get a note that we're using a parameter that some might call "old and busted", but the instance does start as normal:</div><div><br /></div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; startup<br /><span style="color: red;">ORA-32004: obsolete or deprecated parameter(s) specified for RDBMS instance</span><br />ORACLE instance started.</span><br /><div><br /></div><div>Now when we check, we see that Oracle just completely ignored the setting we specified for the old parameter:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter diagnostic_dest</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">diagnostic_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;/oracle/app/oracle</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter background_dump_dest</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">background_dump_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;/oracle/app/oracle/diag/rdbms/</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ora11201/ora11201/trace</span></div><div><br /><h3>Disabling ADR</h3>Now, it is possible to disable the ADR and go back to the way things were prior to Oracle 11g. First you'll need to set the hidden parameter _diag_adr_enabled to FALSE, for example if using spfile:<br /><br /><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter system set "_diag_adr_enabled"=false scope=spfile;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">System altered.</span><br /><br />Then you MUST set the old %_DUMP_DEST parameters to point to the desired locations. These directories must exist and be writable by oracle, obviously.<br /><br /><span style="font-family: Courier New, Courier, monospace;"></span><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter system set background_dump_dest='/oracle/app/oracle/admin/ora11201/bdump' scope=spfile;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">System altered.</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter system set core_dump_dest='/oracle/app/oracle/admin/ora11201/cdump' scope=spfile;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">System altered.</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter system set user_dump_dest='/oracle/app/oracle/admin/ora11201/udump' scope=spfile;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">System altered.</span><br /><br /><br /><br /><br />Then we restart the database instance for the settings to take effect. I've tested this on my 11.2.0.1 sandbox (these are the commands from that very session) and it works. Note that you will again see the ORA-32004 warning about having a deprecated parameter set, that is to be expected. However, this time the settings take effect:<br /><br /><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter dump_dest</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span><br /><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span><br /><span style="font-family: Courier New, Courier, monospace;">background_dump_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;/oracle/app/oracle/admin/ora11</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;201/bdump</span><br /><span style="font-family: Courier New, Courier, monospace;">core_dump_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;/oracle/app/oracle/admin/ora11</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;201/cdump</span><br /><span style="font-family: Courier New, Courier, monospace;">user_dump_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;/oracle/app/oracle/admin/ora11</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;201/udump</span><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter "_diag_adr_enabled"</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span><br /><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span><br /><span style="font-family: Courier New, Courier, monospace;">_diag_adr_enabled &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;boolean &nbsp; &nbsp; FALSE</span><br /><div><br /></div><br /><b>HOWEVER</b>, I do not advise doing this in production at all, and certainly not without the blessing of Oracle Support for any reason. I simply don't think there is anything to be gained by reverting to this method, and you lose the flexibility and power of having the alert data in XML format, which we'll see how to harness in a future post!<br /><br /><br />This ends Part 1 of my ADR intro series, which focused ADR location(s). Part 2 will focus on diagnostic files and how Oracle uses and maintains them.</div></div>