---
layout: post
title: Returning Error Codes from sqlplus to Shell Scripts
date: '2015-01-06T15:32:00.000-06:00'
author: Don Seiler
tags:
- ksh
- 11gR2
- oracle
modified_time: '2015-01-06T15:38:30.590-06:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-2306752854358152950
blogger_orig_url: http://www.seiler.us/2015/01/returning-error-codes-from-sqlplus-to.html
---

When I have to run SQL scripts, I prefer to do it via executable ksh scripts (I use ksh because it's usually an Oracle pre-requisite so I can rely on it being installed). One thing that I've just recently started adding into my scripts is exiting sqlplus on error and returning the ORA error code. This is done via the <a href="http://docs.oracle.com/cd/E11882_01/server.112/e16604/ch_twelve052.htm" target="_blank">WHENEVER SQLERROR</a> feature of sqlplus:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sqlplus / as sysdba &lt;&lt;EOF</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; whenever sqlerror exit sql.sqlcode</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alter tablespace foo</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rename to foo_old;</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; create tablespace foo</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; datafile size 100m;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alter table foo move tablespace $TABLESPACE_NAME nocompress;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">EOF</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">RETURN_CODE=$?</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">if [ $RETURN_CODE -ne 0 ]; then</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "*** Tablespace renaming error code $RETURN_CODE. ***"</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit $RETURN_CODE;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">fi</span><br /><br />In this example we rename a tablespace and then create a new tablespace in its place and move a table there. It seems rather contrived but this is actually what I'm doing to move tables to an uncompressed and unencrypted tablespace to test storage vendor deduplication claims. But I digress ...<br /><br />To test this, I used a tablespace that doesn't exist. This results in an ORA-00959 error when the tablespace does not exist. However, the return code I get was 191. I spent a good portion of the day testing and retesting with all sorts of debug output until I stumbled across <a href="http://stackoverflow.com/questions/14734131/managing-error-handling-while-running-sqlplus-from-shell-scripts#comment39232347_14829264" target="_blank">this comment</a>. Since Linux (and I'm told Unix) return codes only go up to 255, the ORA sqlcode value of 959 is wrapped until there is a remainder. The value of 191 is the difference, achieved simply by modulo operation: <br /><br /><div style="text-align: center;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">959 % 256 = 191</span></div><br />&nbsp;And suddenly the skies were cleared.<br /><br />As always, hope this helps!