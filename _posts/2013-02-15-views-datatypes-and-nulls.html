---
layout: post
title: Views, Datatypes and Nulls
date: '2013-02-15T13:47:00.005-06:00'
author: Don Seiler
tags:
- oracle
modified_time: '2014-04-02T21:16:43.708-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-7030971187583798359
blogger_orig_url: http://www.seiler.us/2013/02/views-datatypes-and-nulls.html
---

Had an interesting little case come up today when helping a client re-write a view. This legacy application stored a date value as January 1, 1970 when they didn't have a date (basically using it as a de facto NULL). I did my best to lecture the client on why this was a horrible idea, but there was nothing we could do in the short term.<br /><br />Anyway, he had a view that would use a DECODE function to convert a date of 1970/01/01 to NULL, otherwise just pass the date through. However, we noticed that the view schema said the field was defined as varchar2(18) instead of date. Here is my example using a view on DBA_OBJECTS:<br /><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; create or replace view test_objects1 (object_name, created) as</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 2 &nbsp;select object_name, decode (created</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, to_date('1970/01/01','yyyy/mm/dd')</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, null, created)</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 5 &nbsp;from dba_objects;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">View created.</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">SQL&gt;</span><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; desc test_objects1;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Null? &nbsp; &nbsp;Type</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;----------------------------------------- -------- -------------</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;OBJECT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VARCHAR2(128)</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VARCHAR2(18)</span><br /><div><br /><a class="vt-p" href="https://www.blogger.com/null" name="more"></a><br /><a name='more'></a><br /></div><div>I suggested we wrap that NULL in a to_date function just to see what happens, and sure enough that gives us what we want:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; create or replace view test_objects2 (object_name, created) as</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 2 &nbsp;select object_name, decode (created</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, to_date('1970/01/01','yyyy/mm/dd')</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, to_date(null), created)</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 5 &nbsp;from dba_objects;</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">View created.</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt;</span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; desc test_objects2;</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Null? &nbsp; &nbsp;Type</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp;----------------------------------------- -------- -------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp;OBJECT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VARCHAR2(128)</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DATE</span></div></div><div><br /></div><div>It seems silly to wrap NULL in a TO_DATE, or do any function on a NULL value. One would hope that Oracle sees the NULL and short-circuits the function to avoid doing the unnecessary work.<br /><br />Update: Looks like this is <a class="vt-p" href="http://docs.oracle.com/cd/B19306_01/server.102/b14200/functions040.htm" target="_blank">documented functionality in the DECODE function</a>:<br /><blockquote class="tr_bq">Oracle automatically converts expr and each search value to the datatype of the first search value before comparing. Oracle automatically converts the return value to the same datatype as the first result. If the first result has the datatype CHAR or <i>if the first result is null, then Oracle converts the return value to the datatype VARCHAR2</i>.</blockquote><br />Update #2: Thanks to Sayan in the comments for tipping me off about NULLIF, which seems like the best option, doing exactly what we want without having to convert the type:<br /><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;SQL&gt; create or replace view test_objects3 (object_name, created) as</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 2 &nbsp;select object_name</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, nullif (created</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, to_date('1970/01/01','yyyy/mm/dd'))</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 5 &nbsp;from dba_objects;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">View created.</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">SQL&gt;</span><br /><span style="font-family: Courier New, Courier, monospace;">SQL&gt; desc test_objects3;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Null? &nbsp; &nbsp;Type</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;----------------------------------------- -------- -------------</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;OBJECT_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VARCHAR2(128)</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DATE</span></div><div><br /></div>