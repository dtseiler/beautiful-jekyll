---
layout: post
title: Battling Bigfile Backup Bottlenecks
date: '2014-03-26T13:44:00.000-05:00'
author: Don Seiler
tags:
- bigfile
- backup
- 11gR2
- 12c
- rman
- oracle
- parallel
modified_time: '2014-03-26T13:51:57.202-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-1499000296838354441
blogger_orig_url: http://www.seiler.us/2014/03/battling-bigfile-backup-bottlenecks.html
---

Last Friday I kicked off a database backup to an NFS destination, using the standard "backup as compressed backupset database" syntax. Loyal readers of this blog may recall that I'm the proud custodian of a 25 Tb database, so this backup normally takes a few days, with an expected completion on Monday morning. However it was still running on Wednesday, and reviewing the logs I saw that there was just 1 channel (of the original 8) still running. The backup file that this channel was writing happened to include our largest bigfile datafile, which weighs in at nearly <i>8 Tb</i>. Reviewing my new backup script I realized that I had neglected to specify a SECTION SIZE parameter. An example of its usage is:<br /><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">RMAN&gt; backup as compressed backupset</span></div><div><span style="font-family: Courier New, Courier, monospace;">2&gt; section size 64G</span></div><div><span style="font-family: Courier New, Courier, monospace;">3&gt; database;</span><br /><div><br /></div><div>Without it, RMAN has decided to create a backup piece that bundled my 8 Tb datafile with a few others and then write it out to disk on one channel. Obviously this isn't what we wanted.</div><div><br /><a name='more'></a><br /></div><div>I'm not a big fan of bigfile tablespaces, primarily because you lose the benefits of parallelism when huge files can only be handled by a single channel, as with datafile copy operations and backups. In 11g, however, <a class="vt-p" href="http://docs.oracle.com/cd/E25054_01/backup.1111/e10642/rcmbckad.htm#BRADV89543" target="_blank">Oracle has introduced multi-section backups via the SECTION SIZE</a> option for RMAN backups. This option tells RMAN to break a large file into sections of the specified size so that the work can be done in parallel. If the specified size is larger than the file, then it is simply ignored for that file.</div><div><br /></div><div>There is a limitation in that the file can be split into a maximum of 256 sections. So, if you specify a section size that would result in more than 256 sections being created, Oracle RMAN will increase the size so that <i>exactly </i>256 sections are created. This is still enforced today in Oracle 12c.</div><div><br /></div><div>Another limitation in Oracle 11g is that multi-section backups cannot be done with image copy backups. Those must still be done as a whole file and so can still be a huge bottleneck. However <a class="vt-p" href="http://docs.oracle.com/cd/E16655_01/backup.121/e17630/rcmbckba.htm#BRADV665" target="_blank">this is no longer a problem in Oracle 12c</a>, and multi-section image copy backups are possible. I'm looking forward to using this as we also use image copy backups as part of our recovery strategy.</div><div><br />To highlight the parallel benefits, I ran a compressed backup of a 1.5 Tb bigfile tablespace using 8 channels. The first one does NOT use&nbsp;section&nbsp;size and so only goes over one channel:<br /><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">Starting backup at 2014/03/25 14:35:41</span><br /><span style="font-family: Courier New, Courier, monospace;">...</span><br /><span style="font-family: 'Courier New', Courier, monospace;">channel c1: backup set complete, elapsed time: 17:06:09</span><br /><span style="font-family: Courier New, Courier, monospace;">Finished backup at 2014/03/26 07:41:51</span></div><div><br /></div><div>The second one uses a section size of 64 Gb (otherwise same command &amp; file):</div><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">Starting backup at 2014/03/26 07:41:52</span><br /><span style="font-family: Courier New, Courier, monospace;">...</span></div></div></div><div><span style="font-family: Courier New, Courier, monospace;">Finished backup at 2014/03/26 09:48:33</span></div><div><br /></div><div>You can see the huge impact made by making use of the multi-section backup option. A single channel took over 17 hours to back it up. Using 8 channels with a section size of 64 Gb took only just over 2 hours. Eyeballing the log shows an average of around 6 minutes per section. Definitely much better than waiting for a single channel to do all the work when the rest of the system is waiting.</div>