---
layout: post
title: ORA-00600 [kkzlpllg:5] When Dropping MView Log
date: '2014-03-30T18:43:00.001-05:00'
author: Don Seiler
tags:
- 11gR2
- materialized view logs
- materialized views
- oracle
modified_time: '2014-04-08T16:38:45.456-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-7434923267926477195
blogger_orig_url: http://www.seiler.us/2014/03/ora-00600-kkzlpllg5-when-dropping-mview.html
---

<span style="font-family: inherit;">This week a co-worker and I have been doing some rapid-fire testing to improve fast-refresh performance on an old materialized view, which does some summary aggregations on a 1.9 <b><i>billion </i></b>row (and growing) master table. One of the things we tested was using the <a class="vt-p" href="http://docs.oracle.com/cd/E11882_01/server.112/e41084/statements_6003.htm#SQLRF54214" target="_blank">new-in-11gR2 COMMIT SCN feature</a>. There is a great <a class="vt-p" href="http://www.adellera.it/blog/2009/11/03/11gr2-materialized-view-logs-changes/" target="_blank">blog post describing the benefits of this feature by Alberto Dell'Era</a>. To quickly summarize and over-simplify, it provides a much faster way to update rows in the materialized view log that are eligible for refresh and purging. This definitely sounds like something we'd want, so let's roll!</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Well we quickly hit a snag when testing our creation script the second time around, when it wouldn't let us drop the materialized view log:</span><span style="font-family: inherit;"><br /></span><span style="font-family: Courier New, Courier, monospace;">SQL&gt; DROP MATERIALIZED VIEW LOG ON FOO.BAR</span><br /><span style="font-family: Courier New, Courier, monospace;">*</span><br /><span style="font-family: Courier New, Courier, monospace;">ERROR at line 1:</span><br /><span style="font-family: Courier New, Courier, monospace;">ORA-00600: internal error code, arguments: [kkzlpllg:5], [], [], [], [], [],[], [], [], [], [], []</span><br /><span style="font-family: inherit;"><br /></span><br /><div style="background-color: white;"><span style="font-family: inherit;">We found that we also could no longer perform fast refreshes of the materialized view, getting the same ORA-00600 error. Our initial MOS search turned up <a class="vt-p" href="https://support.oracle.com/epmos/faces/DocContentDisplay?id=14158012.8" target="_blank">Doc ID 14158012.8, which indicates Bug 14158012 (Orphan rows in SNAP_LOGDEP$ causes ORA-600 [kkzlpllg:5])</a>. The bug description is:</span></div><blockquote class="tr_bq" style="background-color: white;"><span style="font-family: inherit;">With this bug, when there are orphan rows in SNAP_LOGDEP$ with RSCN=NULL,<br /> </span><span style="font-family: inherit;">a CREATE MATERIALIZED VIEW or DROP MATERIALIZED VIEW statement will report&nbsp;</span><span style="font-family: inherit;">ORA-600 [kkzlpllg:5].</span></blockquote><br /><span style="font-family: inherit;"></span><br /><a name='more'></a><br /><span style="font-family: inherit;">I verified that we did have such NULL RSCN values in SNAP_LOGDEP$ related to the master table here.</span><br /><div><br style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="font-family: Courier New, Courier, monospace;"><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">SQL&gt; select d.tableobj#, o.name</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp; 2&nbsp; from sys.snap_logdep$ d, sys.obj$ o</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp; 3&nbsp; where d.tableobj# = o.obj#</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp; 4&nbsp; and o.name='BAR'</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp; 5&nbsp; and d.rscn is null;</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp;TABLEOBJ# NAME</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">---------- ------------------------------</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp;&nbsp;&nbsp; 605668&nbsp;BAR</span><br style="orphans: 2; text-align: -webkit-auto; widows: 2;" /><span style="orphans: 2; text-align: -webkit-auto; widows: 2;">&nbsp;&nbsp;&nbsp; 605668&nbsp;BAR</span></span></div><br /><span style="font-family: inherit;">Unfortunately, that doc also said there was <b>no workaround</b> other than to apply a one-off patch (otherwise fixed in 11.2.0.4 and 12c)! Not exactly the quick fix we were hoping for.&nbsp;</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">However, we did some more searching and found <a class="vt-p" href="https://support.oracle.com/epmos/faces/DocContentDisplay?id=1310296.1" target="_blank">Doc 1310296.1:&nbsp;</a></span><span style="font-family: inherit;"><a class="vt-p" href="https://support.oracle.com/epmos/faces/DocContentDisplay?id=1310296.1" target="_blank">Internal Error ORA-00600 [kkzlpllg:5] When Executing Drop Materialized View Log</a></span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Pretty much the same thing, only this gives us a workaround:</span><span style="font-family: inherit;"><br /></span><br /><blockquote class="tr_bq"><span style="font-family: inherit;">Since the information stored in the Materialized View log is bogus in any case, the Materialized View Log is not useable anymore. The only option is to drop this object and re-create it. To make this possible, a dummy non-NULL value needs to be written into the RSCN column for that table.</span></blockquote><span style="font-family: inherit;">So we update those rows to set RSCN to a dummy value (9999):</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: Courier New, Courier, monospace;">SQL&gt; UPDATE snap_logdep$<br />&nbsp; 2 &nbsp;SET RSCN = 9999<br />&nbsp; 3 &nbsp;WHERE tableobj# = 605668</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; 4 &nbsp;AND RSCN IS NULL;</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">And we were able to drop the materialized view log and resume testing afterwards.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Hopefully this article saves someone from hitting the same initial roadblock that I did. Especially nice to see the Oracle support docs contradicting themselves!</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">We also made another interesting find with this particular materialized view that I'll be blogging about later. Definitely an eye-opener, face-palmer and forehead-smacker all in one.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">UPDATE - 8 April 2014</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Nothing mind blowing, but a little time saver if you know the object name. This doesn't take the owner into account, so <a class="vt-p" href="https://www.youtube.com/watch?v=Jmg86CRBBtw" target="_blank">be careful out there</a>.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: Courier New, Courier, monospace;">update snap_logdep$</span><br /><span style="font-family: Courier New, Courier, monospace;">set rscn = 9999</span><br /><span style="font-family: Courier New, Courier, monospace;">where tableobj# = (</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; select distinct d.tableobj#</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; from sys.snap_logdep$ d, sys.obj$ o</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; where d.tableobj# = o.obj#</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; and d.rscn is null</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; and o.name='BAR'</span><br /><span style="font-family: Courier New, Courier, monospace;">)</span><br /><span style="font-family: Courier New, Courier, monospace;">and rscn is null;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><br /><span style="font-family: Courier New, Courier, monospace;">commit;</span><br /><div><br /></div>