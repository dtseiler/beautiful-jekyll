---
layout: post
title: Adding New Partitions with Custom Subpartition Definition (Range-List)
date: '2014-08-21T14:28:00.001-05:00'
author: Don Seiler
tags:
- partitions
- 11gR2
- oracle
modified_time: '2014-08-21T14:28:22.452-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-1263297127758208658
blogger_orig_url: http://www.seiler.us/2014/08/adding-new-partitions-with-custom.html
---

As part of a project for work I wanted to create a script that would create a new range partition but also pre-create all the list subpartitions. By default the subpartitions would be created based on the subpartition template. However for various reasons which I won't get into we don't update or use the subpartition template. I wanted to define the subpartition list as part of the ALTER TABLE ... ADD PARTITION statement. I assumed it was perfectly acceptable but didn't see any obvious examples in my hasty web searching, so I thought I'd share on myself.<br /><br />I start by creating my composite range-list partitioned table:<br /><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">SQL&gt; create table p_objects</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 2 &nbsp;tablespace tbs1</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 3 &nbsp;partition by range(rdate)</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 4 &nbsp;subpartition by list(owner)</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 5 &nbsp;subpartition template</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 6 &nbsp;(</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;subpartition spsys values ('SYS')</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, subpartition spsysaux values ('SYSAUX')</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp; 9 &nbsp;)</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;10 &nbsp;(</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;11 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201301 values less than (to_date('2013/02/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;12 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201302 values less than (to_date('2013/03/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201303 values less than (to_date('2013/04/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201304 values less than (to_date('2013/05/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;15 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201305 values less than (to_date('2013/06/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;16 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201306 values less than (to_date('2013/07/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;17 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201307 values less than (to_date('2013/08/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;18 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201308 values less than (to_date('2013/09/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;19 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201309 values less than (to_date('2013/10/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;20 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201310 values less than (to_date('2013/11/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;21 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201311 values less than (to_date('2013/12/01','YYYY/MM/DD')),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;22 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;partition p201312 values less than (to_date('2014/01/01','YYYY/MM/DD'))</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;23 &nbsp;)</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;24 &nbsp;as select object_id</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;25 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, owner</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;26 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, object_name</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;27 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, object_type</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;28 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, to_date(trunc(dbms_random.value(</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;29 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to_char(to_date('2013/01/01','YYYY/MM/DD'),'J'),</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;30 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to_char(to_date('2013/12/31','YYYY/MM/DD'),'J')</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;31 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)),'J') rdate</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;32 &nbsp;from all_objects</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;33 &nbsp;where owner in ('SYS','SYSAUX');</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><br /></span><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">Table created.</span><br /><div><br /></div><div>This creates the partitions with 2 subpartitions each, per my defined template. For example:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SUBPARTITION_NAME</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------ ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">P201301 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201301_SPSYS</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201301_SPSYSAUX</span></div><div><span style="font-family: Courier New, Courier, monospace;">P201302 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201302_SPSYS</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201302_SPSYSAUX</span></div><div><span style="font-family: Courier New, Courier, monospace;">P201303 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201303_SPSYS</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201303_SPSYSAUX</span></div></div><div><br /></div><div>Next I'll add two more partitions, one with no subpartition definition specified and another with a custom definition:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter table p_objects</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;add partition p201408</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;values less than (to_date('2014/09/01','yyyy/mm/dd'));</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">Table altered.</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter table p_objects</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;add partition p201409</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;values less than (to_date('2014/10/01','yyyy/mm/dd'))</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;subpartition p201409_spdts values ('DTS')</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, subpartition p201409_spsys values ('SYS')</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, subpartition p201409_spsysaux values ('SYSAUX')</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; 9 &nbsp;;</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">Table altered.</span></div></div><div><br /></div><div>The results:</div><div><div><span style="font-family: Courier New, Courier, monospace;">PARTITION_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SUBPARTITION_NAME</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------ ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">P201408 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201408_SPSYS</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201408_SPSYSAUX</span></div><div><span style="font-family: Courier New, Courier, monospace;">P201409 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201409_SPDTS</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201409_SPSYS</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;P201409_SPSYSAUX</span></div></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: inherit;">You can see that the first statement just used the subpartition template as defined in the original CREATE TABLE statement. The second uses the list I defined in the ALTER TABLE statement. I could have only defined the SPDTS subpartition and it would have only used that one and not used SYS or SYSAUX subpartitions at all.</span></div><div><span style="font-family: inherit;"><br /></span></div><div><span style="font-family: inherit;">Hopefully this post helps a few of you in your searching when faced with a similar task. This was probably obvious to most of you but the mind starts to slip for some of us.</span></div>