---
layout: post
title: Upgrading Standalone ASM to Oracle Grid Infrastructure 11.2.0.2? Beware Bug
  1233183.1!
date: '2011-01-03T11:28:00.000-06:00'
author: Don Seiler
tags: 
modified_time: '2011-01-03T11:28:02.128-06:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-7452608371123491756
blogger_orig_url: http://www.seiler.us/2011/01/upgrading-standalone-asm-to-oracle-grid.html
---

<span class="Apple-style-span" style="color: #666666; line-height: 18px;"><span class="Apple-style-span" style="font-family: inherit; font-size: x-small;"><i>NOTE: This post originally appeared on the <a class="vt-p" href="http://www.pythian.com/news/18925/upgrading-standalone-asm-to-oracle-grid-infrastructure-11-2-0-2-beware-bug-1233183-1/">Pythian blog</a>.</i></span></span><br /><br />The past four days have found me very frustrated and at wits' end while testing upgrades of standalone Oracle Grid Infrastructure (ASM) 11.2.0.1 to 11.2.0.2 on RHEL/OEL 5 VMs. The upgrade would seem to go fine, but after rebooting, I would see ASM and LISTENER running under the old (11.2.0.1) grid home directories again.<br /><br />Looking at /etc/oratab, I saw this:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ grep -i asm /etc/oratab</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">+ASM:/u01/app/grid/product/11.2.0/grid_1:N              # line added by Agent</span><br /><br /><br />grid_1 is the old grid home, I expect to see grid_2. The comment about being added by Agent led me to a path where I eventually took a look at /etc/init.d/ohasd, which is basically the master script that starts everything up. I noticed that this file hadn't been updated as part of the patching, and contained this:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ grep -i crs_home /etc/init.d/ohasd </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">ORA_CRS_HOME=/u01/app/grid/product/11.2.0/grid_1</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">export ORA_CRS_HOME</span><br /><br /><a name='more'></a><br />I then ran some web searches for "oracle upgrade 11.2.0.1 ohasd" and found a blog post that had the same problem. Searching My Oracle Support then turned up DocID 1233183.1, titled "Standalone GI: init.ohasd/ohasd not updated after 11201 to 11202 upgrade".<br /><br />The bug is basically what it says, those files are not being updated during upgrades of standalone grid infrastructure. This is due to a logic bug in roothas.pl. I suggest reading the document for details.<br /><br />The workaround is to manually copy those two files after the upgrade finishes. First backup the old files:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ mkdir ~/ohasd_init_backup</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ cd ~/ohasd_init_backup</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ ls /etc/init.d/*ohasd*</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">/etc/init.d/init.ohasd  /etc/init.d/ohasd</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ cp /etc/init.d/*ohasd* .</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ ls</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">init.ohasd  ohasd</span><br /><br /><br />Then copy the 11.2.0.2 files into place (as root):<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># cd /etc/init.d/</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># cp /u01/app/grid/product/11.2.0/grid_2/crs/init/init.ohasd .</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">cp: overwrite `./init.ohasd'? y   </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"># cp /u01/app/grid/product/11.2.0/grid_2/crs/init/ohasd .</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">cp: overwrite `./ohasd'? y</span><br /><br />Obviously, substitute "/u01/app/grid/product/11.2.0/grid_2" with the path your 11.2.0.2 installation directory. NOTE: SLES users need to copy ohasd.sles, rather than ohasd. See the MOS document for details<br /><br />Now, a quick check to make sure the proper home is used:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ grep -i crs_home /etc/init.d/ohasd </span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">ORA_CRS_HOME=/u01/app/grid/product/11.2.0/grid_2</span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">export ORA_CRS_HOME</span><br /><br />Now ensure that the two new scripts have the same ownership and permissions as the old ones. Then reboot to ensure that everything takes effect. After the server comes back up, ensure that all services and oratab are still pointing to the new grid home. Be sure to check "srvctl config" for the asm and listener services, and check the paths in /etc/oratab.<br /><br />This is the second bug with the 11.2.0.2 upgrade process that I've encountered. The first one requires patching the 11.2.0.1 Grid Infrastructure with the July 2010 PSU just to be able to upgrade to 11.2.0.2. Let's hope for some stronger QA in the future.