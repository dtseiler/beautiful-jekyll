---
layout: post
title: What to Expect When You're Changing the DB_UNIQUE_NAME
date: '2014-03-12T18:31:00.000-05:00'
author: Don Seiler
tags:
- 11gR2
- oracle
modified_time: '2014-03-14T11:21:29.784-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-4801886288394022558
blogger_orig_url: http://www.seiler.us/2014/03/what-to-expect-when-you-changing.html
---

<div dir="ltr">I recently had to change the db_unique_name of a database to make it jive with our typical database/DataGuard naming policy of appending the datacenter location. For the sake of this post let's say it was changed from ORCL to ORCL_NYC, since this database is in our fictional New York City datacenter. </div><div dir="ltr"><br /></div><div dir="ltr">I did a quick set of tests and thought I'd share the findings to save anyone any unpleasant surprises. Here are the things to expect when changing DB_UNIQUE_NAME.</div><div dir="ltr"><br /></div><h3>Change the Parameter Value</h3><div dir="ltr">First we obviously have to change the value. How we do so is important.</div><div dir="ltr">The command:</div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">alter system set db_unique_name=orcl_nyc scope=spfile;</span></div><div dir="ltr"><br /></div><div dir="ltr">will result in a db_unique_name of ORCL_NYC, in all uppercase, which is used for the path changes we'll discuss later. However using quotes instead:</div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">alter system set db_unique_name='orcl_nyc' scope=spfile;</span></div><div dir="ltr"><br /></div><div dir="ltr">will result in a lowercase orcl_nyc value used in the parameter and some paths. In either case, the fun begins when you next restart the instance!</div><div dir="ltr"><br /></div><div dir="ltr"></div><a name='more'></a><br /><br /><h3>ADR Location (i.e. alert log)</h3><div dir="ltr">The ADR location appends the DB_UNIQUE_NAME to the location specified by the DIAGNOSTIC_DEST initialization parameter (defaulting to the $ORACLE_BASE environment variable value). When you restart after setting the DB_UNIQUE_NAME, your ADR location will be in a new location using the new DB_UNIQUE_NAME. Probably of most interest to you is that this means your alert log location will move, so any tools or scripts that referenced that file directly (e.g. error-scraping scripts or log-rotation jobs) will need to be updated.&nbsp;</div><div dir="ltr"><br /></div><div dir="ltr">Regardless of quotes or not, the ADR path always used a lowercase string in the path.</div><div dir="ltr"><br /></div><div dir="ltr">Before:</div><div dir="ltr"><br /></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter db_unique_name</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">db_unique_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;ORCL</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter background_dump_dest</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">background_dump_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;/oracle/app/diag/rdbms/orcl/or</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cl/trace</span></div><div><br /></div><div>After:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter db_unique_name</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">db_unique_name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;ORCL_NYC</span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; show parameter background_dump_dest</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TYPE &nbsp; &nbsp; &nbsp; &nbsp;VALUE</span></div><div><span style="font-family: Courier New, Courier, monospace;">------------------------------------ ----------- ------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">background_dump_dest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;/oracle/app/diag/rdbms/orcl_ny</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c/orcl/trace</span></div></div><div><br /></div><div dir="ltr"><br /></div><h3>Datafile and Online Redo Log OMF Location</h3><div dir="ltr">If you have the db_create_file_dest (and optionally db_create_online_log_dest_N) parameter set, then Oracle will use the DB_UNIQUE_NAME value in the OMF location for any new datafiles and redo logs created after the change, assuming a full path isn't specified.</div><div dir="ltr"><br /></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; alter tablespace users add datafile size 10m;</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">Tablespace altered.</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">SQL&gt; select file_name from dba_data_files</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">&nbsp; 2 &nbsp;where tablespace_name='USERS';</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">FILE_NAME</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">--------------------------------------------------------------------------------</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">/oracle/app/oradata/ORCL/datafile/data_D-ORCL_I-3995253326_TS-USERS_FNO-4_1r</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">p30nup</span></div><div dir="ltr"><span style="font-family: Courier New, Courier, monospace;">/oracle/app/oradata/ORCL_NYC/datafile/o1_mf_users_9l1r8dx9_.dbf</span></div><div><br /></div><div>In this case, Oracle will use an uppercase string regardless of whether or not the DB_UNIQUE_NAME is in upper or lower case. Note that existing files won't be affected, this will only apply to new files.</div><div><br /></div><div>If this database is part of a DataGuard configuration, you'll want to be sure to update your db_file_name_convert and log_file_name_convert parameters to point to the new location.</div><div><br /></div><h3>FRA (Backups, Archivelogs, Flashback Logs)</h3><div>In the same spirit of OMF, the FRA will also change locations. Similar to the previous case, the uppercase value of the DB_UNIQUE_NAME is used in the path, regardless of the original case. So, after a change and a couple of log switches, you would see something like this:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; select name from v$archived_log;</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">NAME</span></div><div><span style="font-family: Courier New, Courier, monospace;">--------------------------------------------------------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/fast_recovery_area/ORCL/archivelog/2014_03_12/o1_mf_1_13_9l1sgt20_.a</span></div><div><span style="font-family: Courier New, Courier, monospace;">rc</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/fast_recovery_area/ORCL/archivelog/2014_03_12/o1_mf_1_14_9l1shfjo_.a</span></div><div><span style="font-family: Courier New, Courier, monospace;">rc</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/fast_recovery_area/ORCL_NYC/archivelog/2014_03_12/o1_mf_1_15_9l1sj59</span></div><div><span style="font-family: Courier New, Courier, monospace;">6_.arc</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/fast_recovery_area/ORCL_NYC/archivelog/2014_03_12/o1_mf_1_16_9l1sjw4</span></div><div><span style="font-family: Courier New, Courier, monospace;">k_.arc</span></div></div><div><br /></div><div>Again, this will only affect newly created files. Existing backups, archivelogs and flashback logs will not be affected, they remain cataloged in their present locations and will be accessed just fine. RMAN will delete them when needed (or commanded) and then you could choose to delete the empty directories.</div><div><br /></div><h3>Oracle Wallet</h3><div>I admit this one I didn't think of. If you use an Oracle Wallet, and do not specify a location in the sqlnet.ora file, Oracle looks in the default location of $ORACLE_BASE/admin/&lt;DB_UNIQUE_NAME&gt;/wallet/. Even more interesting, the DB_UNIQUE_NAME value is case sensitive. So you'll need to be aware of this when moving your wallet files to the new location. Here is a quick look at my findings on this matter:</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">-- db_unique_name set with no quotes</span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; select wrl_parameter from v$encryption_wallet;</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">WRL_PARAMETER</span></div><div><span style="font-family: Courier New, Courier, monospace;">--------------------------------------------------------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/admin/ORCL_NYC/wallet</span></div></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><div><span style="font-family: Courier New, Courier, monospace;">-- db_unique_name set with quotes, lowercase</span></div><div><span style="font-family: Courier New, Courier, monospace;">SQL&gt; select wrl_parameter from v$encryption_wallet;</span></div><div><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div><span style="font-family: Courier New, Courier, monospace;">WRL_PARAMETER</span></div><div><span style="font-family: Courier New, Courier, monospace;">--------------------------------------------------------------------------------</span></div><div><span style="font-family: Courier New, Courier, monospace;">/oracle/app/admin/orcl_nyc/wallet</span></div></div><div><br /></div><div>I can't say if this makes a difference when running on Windows, which I believe is case-insensitive. But on Linux it makes a difference.</div><div><br /></div><h3>Conclusion</h3><div>That wraps this one up. I hope it helps a few people out and saves them an hour or two of head-scratching or worse. If there's anything I forgot, please let me know and I'll update this post.</div>