---
layout: post
title: Beware the /var/tmp/.oracle Hidden Directory!
date: '2010-11-12T14:29:00.005-06:00'
author: Don Seiler
tags: 
modified_time: '2010-11-20T10:40:55.405-06:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-4605358928070863866
blogger_orig_url: http://www.seiler.us/2010/11/beware-vartmporacle-hidden-directory.html
---

NOTE: This post originally appeared on the Pythian blog.<br /><br />A few months ago, we had a test instance complaining that it couldn't write to ASM. This was an 11.1.0.7 single (non-RAC) instance on Oracle Enterprise Linux 5, using ASM for the storage. We first saw these errors in the alert log:<br /><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-15032: not all alterations performed&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-29702: error occurred in Cluster Group Service operation</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-29702: error occurred in Cluster Group Service operation&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ERROR: error ORA-15032 caught in ASM I/O path&nbsp;</span></span><br /><br />Uh-oh, that doesn't look good. So I log into the ASM instance and try to see if the disks are OK:</div><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; select path, mount_status from v$asm_disk;&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">select path, mount_status from v$asm_disk&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ERROR at line 1:&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-15032: not all alterations performed&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-29702: error occurred in Cluster Group Service operation&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-29702: error occurred in Cluster Group Service operation</span></span><br /><br />I can't even query that. <a href="http://www.youtube.com/watch?v=1DsFMJQHbMs">As Ted would say</a>, "strange things are afoot at the Circle K."<br /><a name='more'></a>To be safe, I thought I'd try to shutdown the DBMS instance, which also failed without having to abort:</div><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; shutdown immediate&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-00204: error in reading (block 1, # blocks 1) of control file&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-00202: control file: '+FOOTEST_DATA/footest1_footest_db/control01.ctl'&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">ORA-15081: failed to submit an I/O operation to a disk&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; shutdown abort ORACLE instance shut down.&nbsp;</span></span><br /><br />We decided to restart the whole DBMS/ASM/CSS stack, but CSS wouldn't stop either:</div><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">-bash-3.2# /etc/init.d/init.cssd stop&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">Stopping Cluster Synchronization Services.&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">Unable to communicate with the Cluster Synchronization Services daemon.&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">Shutdown has begun. The daemons should exit soon.&nbsp;</span></span><br /><br />We ended up booting the server altogether, after which everything came up nicely. We filed an SR with Oracle Support, who directed us to Note 391790.1 (Unable To Connect To Cluster Manager Ora-29701). This note lists the cause, quite simply, as:<br /><blockquote>The hidden directory '/var/tmp/.oracle' was removed while instances &amp; the CRS stack were up and running. Typically this directory contains a number of "special" socket files that are used by local clients to connect via the IPC protocol (sqlnet) to various Oracle processes including the TNS listener, the CSS, CRS &amp; EVM daemons or even database or ASM instances. These files are created when the "listening" process starts.</blockquote>The solution is to restart CRS or reboot the machine. Our /var/tmp/.oracle directory looked like this:</div><div><br /></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">[oracle@footest ~]$ ls -la /var/tmp/.oracle</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">total 12&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">drwxrwxrwt 2 root &nbsp; root 4096 May &nbsp;8 15:03 .&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">drwxrwxrwt 3 root &nbsp; root 4096 May 10 07:02 ..&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 15:03 s#18854.1&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 15:03 s#18854.2&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 15:03 sEXTPROC&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 14:44 sfootestDBG_CSSD&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 14:44 sOCSSD_LL_footest_&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 14:44 sOCSSD_LL_footest_localhost&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 14:44 sOracle_CSS_LclLstnr_localhost_0&nbsp;</span></span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">srwxrwxrwx 1 oracle dba &nbsp; &nbsp; 0 May &nbsp;8 15:03 sPNPKEY&nbsp;</span></span><br /><br />I did some sandbox testing, and found that only the Oracle and root OS users could delete that directory, and was able to duplicate the error every time when doing so.<br /><br />However, I really was dumbstruck that Oracle would have so critical a directory in /var/tmp! I politely note this to Oracle Support, who justified this location with a few solid reasons:<br /><ul><li>It has always been in this location (and still is in 11gR2).&nbsp;</li><li>/var/tmp/.oracle is a hidden directory, so it probably won't be noticed by any miscreants looking to cause trouble.&nbsp;</li></ul>OK, I was being sarcastic, these reasons are awful. The only safeguard they gave was "make sure no one deletes it." We scoured the server for cron jobs that would automatically clean out /var/tmp but didn't find any, nor any bash history suggesting malice. The only thing that we could think of was that this test server was in a VM (Citrix Xen), although one would hope that it doesn't happen at all, regardless. We certainly could not find an explanation, but now we're aware to not delete /var/tmp/.oracle while the instances are running (even though we never did before).<br /><br />Surachart Opun has also <a href="http://surachartopun.com/2009/01/vartmporacle-hidden-directory.html">blogged on this topic</a>.</div>