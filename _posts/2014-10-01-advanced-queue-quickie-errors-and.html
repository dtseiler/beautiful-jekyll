---
layout: post
title: 'Advanced Queue Quickie: Errors and Privileges'
date: '2014-10-01T23:07:00.001-05:00'
author: Don Seiler
tags:
- 11gR2
- advanced queues
- oracle
modified_time: '2014-10-01T23:07:50.266-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-1242379186923848277
blogger_orig_url: http://www.seiler.us/2014/10/advanced-queue-quickie-errors-and.html
---

File this one under the misleading-errors department. One of my developers was working with a new queue. He pinged me when he got this error trying to create a job that used the queue:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ERROR at line 1:</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ORA-27373: unknown or illegal event source queue</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ORA-06512: at "SYS.DBMS_ISCHED", line 124</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ORA-06512: at "SYS.DBMS_SCHEDULER", line 314</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ORA-06512: at line 2</span><br /><br />The CREATE_JOB statement was:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">BEGIN</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">DBMS_SCHEDULER.CREATE_JOB(</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">job_name =&gt; 'foo.bar_q_job',</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">job_type =&gt; 'PLSQL_BLOCK',</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">job_action =&gt; 'begin foo.bar_pkg.consume_bar_queue(); end;',</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">queue_spec =&gt; 'BAR.BAR_Q, FOO_BAR_AGENT',</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">enabled =&gt; true,</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">comments =&gt; 'This is a job to consume the bar.bar_q entries that affect foo.');</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">END;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/</span><br /><br />After a few minutes of banging our heads, it became obvious that this was a permissions problem. The queue was owned by BAR, the job was being created as FOO. The ORA error message could/should have made this more obvious, in my opinion.<br /><br />Anyway, the fix was simply to grant access to FOO:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">DBMS_AQADM.GRANT_QUEUE_PRIVILEGE(</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; privilege &nbsp;=&gt; 'ALL',</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; queue_name =&gt; 'bar.bar_q',</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp; &nbsp; &nbsp; &nbsp; grantee &nbsp; &nbsp;=&gt; 'foo' );</span><br /><div><br />Hope this saves some banged heads for others.</div>