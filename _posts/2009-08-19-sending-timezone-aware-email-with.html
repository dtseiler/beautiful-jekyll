---
layout: post
title: Sending Timezone-Aware Email with UTL_SMTP
date: '2009-08-19T12:32:00.000-05:00'
author: Don Seiler
tags: 
modified_time: '2010-11-20T11:35:13.875-06:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-5759278013173304883
blogger_orig_url: http://www.seiler.us/2009/08/sending-timezone-aware-email-with.html
---

<em><span class="Apple-style-span" style="font-size: x-small;">Originally posted at <a href="http://www.pythian.com/news/1976/sending-timezone-aware-email-with-utl_smtp">The Pythian Group blog</a>.</span></em><br /><br />I’m back again with another in what I hope will be a long line of “Quick Tips for Newbies” series.<br /><br />At The Pythian Group, we have employees all over the globe, from our headquarters in Ottawa to regional offices in Boston, Prague, India and Sydney, and a few scattered remote workers in Seattle, Paris, Kiev, Brazil, South Africa and Wisconsin, among other places. In other words, we are spread across multiple timezones, and since it wasn’t too long ago that everyone was in Ottawa, this is something that still presents little quirks.<br /><br />One such quirk involved email generated by one of our internal Oracle instances—via a stored procedure that used <code>UTL_SMTP</code> to send the messages—did not have timezone information in the “Date” email header. As a result, they would be stamped with the hour in Eastern timezone (Ottawa time), but the mail clients would think that hour was local. Depending on where you are relative to Ottawa, this could be many hours in the past or future. Of course, this wouldn’t be noticed if you were in Ottawa or even Boston, both in Eastern. For the rest, it was at the very least, an annoyance—but one that is easily fixed.<br /><br /><a name='more'></a>Looking at the PL/SQL stored procedure that we used to generate email messages, I saw that the “Date” header was being built with this code:<br /><br /><span class="Apple-style-span" style="font-size: x-small;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">date_hdr := 'Date: '||to_char(sysdate,'dd Mon yy hh24:mi:ss');</span></span><br /><br />The fix is almost trivial—just use <code>SYSTIMESTAMP</code> instead of <code>SYSDATE</code>, and include the timezone in the <code>TO_CHAR</code> function:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">date_hdr := 'Date: '||to_char(systimestamp,'dd Mon yy hh24:mi:ss tzhtzm');</span></span><br /><br />Voila!  Emails now had a full Date header. And there was much rejoicing from around the world.<br /><br />Here’s a quick query to highlight the difference:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; select to_char(sysdate,'dd Mon yy hh24:mi:ss') from dual;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;"><br /></span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">TO_CHAR(SYSDATE,'D</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">------------------</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">01 Dec 08 18:50:02</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;"><br /></span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; select to_char(systimestamp,'dd Mon yy hh24:mi:ss tzhtzm') from dual;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;"><br /></span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">TO_CHAR(SYSTIMESTAMP,'DD</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">------------------------</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">01 Dec 08 18:50:10 -0500</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;"><br /></span></span><br />Even if you aren’t sending email to all the ends of the Earth, it won’t hurt to make your messages timezone-aware. I’m sure it will save some confusion and frustration down the line.<br /><br /><em>Note: I discovered the fix via <a href="http://hidowb.blogspot.com/2008/04/time-zone-and-header-in-emails-using.html">this blog post</a>, which seems to be invite-only at the time of this writing.</em>