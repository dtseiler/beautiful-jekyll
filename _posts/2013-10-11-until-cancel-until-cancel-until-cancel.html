---
layout: post
title: UNTIL CANCEL UNTIL CANCEL UNTIL CANCEL
date: '2013-10-11T15:07:00.001-05:00'
author: Don Seiler
tags:
- 11g
- 11gR2
- recovery
- oracle
- restore
modified_time: '2013-10-11T16:10:18.510-05:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-2023966840859881837
blogger_orig_url: http://www.seiler.us/2013/10/until-cancel-until-cancel-until-cancel.html
---

Yesterday I was creating a new Oracle 11.2.0.3 database from a copy of datafiles and archivelogs taken from our standby. I was sure to include archivelogs from just prior to well after the span of the datafile backup time. I had created a new controlfile, gotten everything mounted and recovered all of the archivelogs I had using "recover database using backup controlfile;". The next step was to open the new database with reset logs, right? WRONG.<br /><br />Here is my sqlplus session showing the end of the recovery and my attempt to open the database:<br /><br /><div><span style="font-family: Courier New; orphans: 2; text-align: -webkit-auto; widows: 2;">ORA-00279: change 506393850182 generated at 10/04/2013 20:54:13 needed for<br />thread 3<br />ORA-00289: suggestion :<br />/mnt/prod/fra/PROD/archivelog/2013_10_10/o1_mf_3_36561_%u_.arc<br />ORA-00280: change 506393850182 for thread 3 is in sequence #36561<br />ORA-00278: log file<br />'/mnt/</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">prod</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">/fra/arch/arch_D-</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">PROD</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">_id-3948365078_S-36560_T-3_A-767893550_nkom2l82'</span><br /><span style="font-family: Courier New; orphans: 2; text-align: -webkit-auto; widows: 2;">no longer needed for this recovery<br /><br /><br />ORA-00308: cannot open archived log<br />'/mnt/</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">prod</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">/fra/</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">PROD</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">/archivelog/2013_10_10/o1_mf_3_36561_%u_.arc'</span><br /><span style="font-family: Courier New; orphans: 2; text-align: -webkit-auto; widows: 2;">ORA-17503: ksfdopn:4 Failed to open file<br />/mnt/</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">prod</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">/fra/</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">PROD</span><span style="font-family: 'Courier New'; orphans: 2; text-align: -webkit-auto; widows: 2;">/archivelog/2013_10_10/o1_mf_3_36561_%u_.arc</span><br /><span style="font-family: Courier New; orphans: 2; text-align: -webkit-auto; widows: 2;">ORA-17500: ODM err:File does not exist</span><br /><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New;"><br />SQL&gt; alter database open resetlogs;<br />alter database open resetlogs<br />*<br />ERROR at line 1:<br />ORA-01113: file 1 needs media recovery<br />ORA-01110: data file 1:<br />'/mnt/</span><span style="font-family: 'Courier New';">prod</span><span style="font-family: 'Courier New';">/data/</span><span style="font-family: 'Courier New';">PROD</span><span style="font-family: 'Courier New';">/datafile/data_D-</span><span style="font-family: 'Courier New';">PROD</span><span style="font-family: 'Courier New';">_I-3948365078_TS-SYSTEM_FNO-1_c4olc</span><span style="font-family: 'Courier New';">3jf'</span></div></div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: 'Courier New';"></span><br /><br /><a name='more'></a><span style="font-family: 'Courier New';"><br /></span></div><span style="font-family: inherit;">This didn't make sense to me. I had been sure to include and recover archivelogs from beyond the database copy backup. No datafiles in v$datafile were listed as fuzzy. Everything should be consistent! On a whim (and out of ideas), I decided to restore 15 more archivelogs from the standby, fed them to the new database but still same result.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Then I looked at how that recovery phase ended and grew suspicious. I had just used the "recover database using backup controlfile;" syntax because that was listed in the trace controlfile I had based my scripts off of. I noticed now that it didn't have an "UNTIL CANCEL" clause at the end that I had used years in the past when doing recoveries like this. So I decided to test this by issuing the command with that clause and just cancelling right away:</span><br /><span style="font-family: inherit;"><br /></span><br /><div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New;">SQL&gt; recover database using backup controlfile until cancel;<br />ORA-00279: change 506393850182 generated at 10/04/2013 20:54:13 needed for<br />thread 3<br />ORA-00289: suggestion :<br />/mnt/</span><span style="font-family: 'Courier New';">prod</span><span style="font-family: 'Courier New';">/fra/</span><span style="font-family: 'Courier New';">PROD</span><span style="font-family: 'Courier New';">/archivelog/2013_10_10/o1_mf_3_36561_%u_.arc</span></div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New;">ORA-00280: change 506393850182 for thread 3 is in sequence #36561<br /><br /><br />Specify log: {&lt;RET&gt;=suggested | filename | AUTO | CANCEL}<br />CANCEL<br />Media recovery cancelled.</span></div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New;"><br />SQL&gt; alter database open resetlogs;</span></div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New;"><br />Database altered.</span></div></div><div style="font-family: Tahoma; orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: Courier New;"><br /></span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: inherit;">Bingo, works like a charm. My guess is that if I had used UNTIL CANCEL in my initial recovery, it would have ended cleanly when it ran out of archivelogs to recover and I would have been able to open the database then as well.</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: inherit;"><br /></span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: inherit;">However I have a beef with what is, in my humble opinion, a misleading error message. That system datafile really didn't need any more recovery. To me this is basically a bug in Oracle over semantics in how the log recovery ended. I'd be interested to know what others think, please comment below.</span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: inherit;"><br /></span></div><div style="orphans: 2; text-align: -webkit-auto; widows: 2;"><span style="font-family: inherit;">But for now, I'll be sure to repeat "UNTIL CANCEL" to myself when manually recovering archivelogs like this.</span></div>