---
layout: post
title: GNU basename in PL/SQL
date: '2008-10-01T10:20:00.000-05:00'
author: Don Seiler
tags: 
modified_time: '2010-11-20T11:42:38.005-06:00'
blogger_id: tag:blogger.com,1999:blog-7032512792942232766.post-3448308440623065519
blogger_orig_url: http://www.seiler.us/2000/10/gnu-basename-in-plsql.html
---

<em><span class="Apple-style-span" style="font-size: x-small;">Reposted from <a href="http://www.pythian.com/blogs/1229/gnu-basename-in-plsql">The Pythian Group blog</a>.</span></em><br /><br />In the process of scripting a database migration, I was in need of something akin to the <a href="http://www.opengroup.org/onlinepubs/007908799/xcu/basename.html">GNU basename</a> utility that I know and love on Linux.  <code>basename</code> is most famous for taking a full file path string and stripping away the leading path component, returning just the name of the file. This can be emulated in PL/SQL with calls to <code>SUBSTR</code> and <code>INSTR</code>, like this:<br /><br /><span class="Apple-style-span" style="font-size: x-small;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">substr(dirname,instr(dirname,'/',-1)+1)</span></span><br /><br />(Thanks to Ian Cary, who shared this logic on <a href="http://www.freelists.org/archives/oracle-l/08-2005/msg01654.html">oracle-l</a>)<br /><br />As you can see, this simply finds the last occurence of <code>/</code>, which is our directory separator on *nix and Solaris operating systems.  On Windows, it would be <code>\</code>. It then returns a substring beginning one character after that last separator until the end of the string. Voila, a basic basename routine!<br /><br />Upon reading the <a href="http://www.opengroup.org/onlinepubs/007908799/xcu/basename.html">basename man page</a> again, I found that basename also takes an optional parameter, a suffix string. If this suffix string is provided, basename will also truncate that string from the end. For example:<br /><br /><span class="Apple-style-span" style="font-size: x-small;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ basename /home/seiler/bookmarks.html</span></span><br /><span class="Apple-style-span" style="font-size: x-small;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bookmarks.html</span></span><br /><span class="Apple-style-span" style="font-size: x-small;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">$ basename /home/seiler/bookmarks.html .html</span></span><br /><span class="Apple-style-span" style="font-size: x-small;"><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">bookmarks</span></span><br /><br />I decided that this would be handy to have, and set out to create a compatible basename function in PL/SQL. Here is what I came up with:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">CREATE OR REPLACE FUNCTION basename (v_full_path IN VARCHAR2,</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">v_suffix IN VARCHAR2 DEFAULT NULL,</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">v_separator IN CHAR DEFAULT '/')</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">RETURN VARCHAR2</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">IS</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">v_basename VARCHAR2(256);</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">BEGIN</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">v_basename := SUBSTR(v_full_path, INSTR(v_full_path,v_separator,-1)+1);</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">IF v_suffix IS NOT NULL THEN</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">v_basename := SUBSTR(v_basename, 1, INSTR(v_basename, v_suffix, -1)-1);</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">END IF;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;"><br /></span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">RETURN v_basename;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">END;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">/</span></span><br /><br />I’ve also added an optional third parameter to specify a directory separator other than the default. It would probably be rarely useful, but not hard to remove if you don’t like it. As you can see, I’ve used similar SUBSTR/INSTR logic to identify the suffix index and prune it out.<br /><br />Here it is in action:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; COLUMN file_name FORMAT a45;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; COLUMN basename FORMAT a15;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; COLUMN no_suffix FORMAT a12;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">SQL&gt; SELECT file_name</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">2          , basename(file_name) as basename</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">3          , basename(file_name, '.dbf') as no_suffix</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">4  FROM dba_data_files;</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;"><br /></span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">FILE_NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BASENAME &nbsp; &nbsp; &nbsp; &nbsp;NO_SUFFIX</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">--------------------------------------------- --------------- ------------</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">/u01/app/oracle/oradata/orcl/users01.dbf &nbsp; &nbsp; &nbsp;users01.dbf &nbsp; &nbsp; users01</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">/u01/app/oracle/oradata/orcl/sysaux01.dbf &nbsp; &nbsp; sysaux01.dbf &nbsp; &nbsp;sysaux01</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">/u01/app/oracle/oradata/orcl/undotbs01.dbf &nbsp; &nbsp;undotbs01.dbf &nbsp; undotbs01</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">/u01/app/oracle/oradata/orcl/system01.dbf &nbsp; &nbsp; system01.dbf &nbsp; &nbsp;system01</span></span><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="font-size: x-small;">/u01/app/oracle/oradata/orcl/example01.dbf &nbsp; &nbsp;example01.dbf &nbsp; example01</span></span><br /><br />I hope this makes your work just a little bit easier, as it has mine.